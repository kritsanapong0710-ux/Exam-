<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arjey Exam Pro - Full System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --success: #10b981; --error: #ef4444; --card: #ffffff; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); color: #1e293b; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        /* Navigation Screens */
        .screen { display: none; flex-direction: column; animation: fadeIn 0.3s ease-in-out; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .card { background: var(--card); padding: 25px; border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; margin-bottom: 20px; }
        input[type="text"] { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #e2e8f0; font-family: 'Kanit'; font-size: 1.1rem; box-sizing: border-box; text-align: center; margin-bottom: 15px; }
        
        .btn { padding: 16px; border-radius: 16px; border: none; cursor: pointer; font-family: 'Kanit'; font-size: 1.1rem; font-weight: 600; transition: 0.2s; width: 100%; margin-top: 10px; }
        .btn-blue { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(37,99,235,0.2); }
        .btn-green { background: var(--success); color: white; }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }

        .option-item { display: flex; align-items: center; padding: 16px; border: 2px solid #f1f5f9; border-radius: 14px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; }
        .option-item:hover { background: #f8fafc; }
        .option-item.selected { border-color: var(--primary); background: #eff6ff; font-weight: 600; }

        .progress-bar { width: 100%; height: 10px; background: #e2e8f0; border-radius: 20px; margin: 20px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }

        /* Review Styles */
        .review-item { padding: 15px; border-radius: 12px; background: #fff1f2; border-left: 5px solid var(--error); margin-bottom: 15px; text-align: left; }
        .txt-wrong { color: var(--error); font-size: 0.95rem; }
        .txt-correct { color: var(--success); font-weight: 600; font-size: 0.95rem; }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        .circle { width: 110px; height: 110px; border: 8px solid var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 2.5rem; font-weight: 700; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="screen active">
        <div style="text-align:center; margin-top:80px;">
            <h1 style="color:var(--primary); font-size:3rem; margin:0;">ARJEY</h1>
            <p style="color:#64748b;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏ã‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏•‡∏Å</p>
            <div class="card" style="margin-top:30px;">
                <input type="text" id="name-input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                <button class="btn btn-blue" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 id="user-display" style="margin:0;">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì...</h2>
            <button onclick="logout()" style="color:var(--error); border:none; background:none; cursor:pointer; font-weight:bold;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        <div class="card">
            <h3 style="margin-top:0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (30 ‡∏Ç‡πâ‡∏≠/‡∏ä‡∏∏‡∏î)</h3>
            <button class="btn btn-blue" onclick="startQuiz('Arjey 1')">‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 1 (Earth Layers & Plates)</button>
            <button class="btn btn-green" onclick="startQuiz('Arjey 2')" style="margin-top:15px;">‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 2 (Rocks & Environment)</button>
        </div>
        <div class="card">
            <h3 style="margin-top:0;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <div id="history-box">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</div>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span id="quiz-title" style="color:var(--primary); font-weight:600;"></span>
            <span id="q-count" style="background:#e2e8f0; padding:4px 12px; border-radius:20px; font-weight:bold;">1/30</span>
        </div>
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <div class="card">
            <h2 id="q-text" style="font-size:1.25rem; margin-top:0; line-height:1.4;"></h2>
            <div id="options-list"></div>
        </div>
        <button class="btn btn-blue" id="next-btn" onclick="submitAnswer()" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>

    <div id="summary-screen" class="screen">
        <div class="card" style="text-align:center;">
            <div class="circle" id="final-score">0</div>
            <h2 id="score-msg" style="margin-bottom:25px;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            <div id="review-section" style="border-top:2px solid #f1f5f9; padding-top:20px;">
                <h3 style="text-align:left;">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î</h3>
                <div id="wrong-list"></div>
            </div>
            <button class="btn btn-blue" onclick="location.reload()" style="margin-top:20px;">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA4p-juKNmXA-AP0mrsOHOXNhatlG0oTd4",
        authDomain: "popmark-a7362.firebaseapp.com",
        projectId: "popmark-a7362",
        storageBucket: "popmark-a7362.firebasestorage.app",
        messagingSenderId: "75115795171",
        appId: "1:75115795171:web:92744e0ec6d56ddf4b6bd6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const quizData = {
        "Arjey 1": [
            { q: "Which layer do we live on?", a: ["Crust", "Mantle", "Outer Core", "Inner Core"], c: 0 },
            { q: "Which is the thickest layer of the Earth?", a: ["Crust", "Mantle", "Ocean", "Atmosphere"], c: 1 },
            { q: "The inner core of the Earth is...", a: ["Liquid", "Solid", "Gas", "Plasma"], c: 1 },
            { q: "The crust is broken into big pieces called...", a: ["Plates", "Blocks", "Bricks", "Tiles"], c: 0 },
            { q: "As we go deeper inside the Earth, it gets...", a: ["Colder", "Hotter", "Lighter", "Softer"], c: 1 },
            { q: "The study of the Earth and its layers is called...", a: ["Biology", "Geology", "Chemistry", "Physics"], c: 1 },
            { q: "Moving plates can cause...", a: ["Rainbows", "Earthquakes", "Seasons", "Tides"], c: 1 },
            { q: "A mountain that erupts lava is a...", a: ["Hill", "Volcano", "Valley", "Plain"], c: 1 },
            { q: "Most earthquakes happen near plate...", a: ["Centers", "Boundaries", "Rivers", "Forests"], c: 1 },
            { q: "When plates push together, they can form...", a: ["Rivers", "Mountains", "Lakes", "Waterfalls"], c: 1 },
            { q: "Which layer is made of liquid metal?", a: ["Crust", "Mantle", "Outer Core", "Inner Core"], c: 2 },
            { q: "The Earth's surface is mainly covered by...", a: ["Land", "Ice", "Water", "Forests"], c: 2 },
            { q: "How many main layers does the Earth have?", a: ["2", "3", "4", "5"], c: 2 },
            { q: "The shaking of the ground is called an...", a: ["Eruption", "Earthquake", "Flood", "Storm"], c: 1 },
            { q: "Thailand is located on which plate?", a: ["Eurasian Plate", "Pacific Plate", "African Plate", "Nazca Plate"], c: 0 },
            { q: "Magma is found in the...", a: ["Crust", "Mantle", "Atmosphere", "Exosphere"], c: 1 },
            { q: "When plates move apart, it creates...", a: ["Mountains", "New Ocean Floor", "Clouds", "Icebergs"], c: 1 },
            { q: "A scientist who studies earthquakes is a...", a: ["Seismologist", "Biologist", "Chemist", "Astronomer"], c: 0 },
            { q: "The 'Pacific Ring of Fire' is famous for...", a: ["Ice", "Volcanoes", "Wind", "Gold"], c: 1 },
            { q: "The thinnest layer of Earth is the...", a: ["Mantle", "Inner Core", "Crust", "Outer Core"], c: 2 },
            { q: "Plates move because of heat from the...", a: ["Sun", "Moon", "Mantle", "Ocean"], c: 2 },
            { q: "Lava is magma that reaches the...", a: ["Surface", "Core", "Atmosphere", "Clouds"], c: 0 },
            { q: "Deep trenches are formed by...", a: ["Plate subduction", "Wind", "Rain", "Ice"], c: 0 },
            { q: "The study of plate movement is...", a: ["Plate Tectonics", "Oceanography", "Meteorology", "Biology"], c: 0 },
            { q: "What tool measures earthquake strength?", a: ["Thermometer", "Seismograph", "Barometer", "Speedometer"], c: 1 },
            { q: "Which core is the hottest?", a: ["Outer", "Inner", "Mantle", "Crust"], c: 1 },
            { q: "Most of the mantle is...", a: ["Gas", "Solid Rock", "Water", "Air"], c: 1 },
            { q: "Tectonic plates 'float' on the...", a: ["Ocean", "Atmosphere", "Asthenosphere", "Exosphere"], c: 2 },
            { q: "Continental crust is ______ than oceanic crust.", a: ["Thinner", "Thicker", "Hotter", "Heavier"], c: 1 },
            { q: "Earthquakes can cause a giant wave called...", a: ["Tornado", "Tsunami", "Hurricane", "Blizzard"], c: 1 }
        ],
        "Arjey 2": [
            { q: "The air around Earth is called the...", a: ["Atmosphere", "Hydrosphere", "Biosphere", "Lithosphere"], c: 0 },
            { q: "All water on Earth is part of the...", a: ["Atmosphere", "Hydrosphere", "Lithosphere", "Core"], c: 1 },
            { q: "Dirty air and water are called...", a: ["Energy", "Pollution", "Climate", "Weather"], c: 1 },
            { q: "Recycling helps to reduce...", a: ["Oxygen", "Waste", "Rain", "Gold"], c: 1 },
            { q: "A mineral is a natural solid...", a: ["Gas", "Liquid", "Material", "Animal"], c: 2 },
            { q: "The study of minerals is...", a: ["Biology", "Mineralogy", "Ecology", "Physics"], c: 1 },
            { q: "Igneous rocks form from cooled...", a: ["Water", "Magma", "Plants", "Ice"], c: 1 },
            { q: "Sedimentary rocks are made of...", a: ["Lava", "Sediments", "Clouds", "Metal"], c: 1 },
            { q: "The ozone layer protects us from...", a: ["Rain", "Snow", "UV rays", "Heat"], c: 2 },
            { q: "Which gas do plants need to grow?", a: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Helium"], c: 2 },
            { q: "The Mohs scale measures mineral...", a: ["Color", "Weight", "Hardness", "Transparency"], c: 2 },
            { q: "Granite is an example of ________ rock.", a: ["Igneous", "Sedimentary", "Metamorphic", "Sand"], c: 0 },
            { q: "Marble is a ________ rock.", a: ["Igneous", "Sedimentary", "Metamorphic", "Liquid"], c: 2 },
            { q: "Cutting down too many trees is called...", a: ["Planting", "Deforestation", "Recycling", "Pollution"], c: 1 },
            { q: "Global warming is caused by too much...", a: ["Oxygen", "Greenhouse gas", "Fresh water", "Snow"], c: 1 },
            { q: "The study of rocks is called...", a: ["Petrology", "Zoology", "Botany", "Astronomy"], c: 0 },
            { q: "Breaking rocks into small pieces is...", a: ["Weathering", "Melting", "Burning", "Squeezing"], c: 0 },
            { q: "Rocks change through the rock...", a: ["Cycle", "Line", "Box", "Circle"], c: 0 },
            { q: "Fossils are mostly found in ________ rocks.", a: ["Igneous", "Sedimentary", "Metamorphic", "Lava"], c: 1 },
            { q: "Metamorphic rocks form from heat and...", a: ["Rain", "Pressure", "Wind", "Light"], c: 1 },
            { q: "Fresh water is found in...", a: ["Oceans", "Rivers and Lakes", "Salt mines", "Desert sand"], c: 1 },
            { q: "What is the hardest mineral?", a: ["Gold", "Diamond", "Talcom", "Iron"], c: 1 },
            { q: "Moving rocks by wind or water is...", a: ["Erosion", "Melting", "Freezing", "Growing"], c: 0 },
            { q: "The study of the environment is...", a: ["Environmental Science", "History", "Math", "Art"], c: 0 },
            { q: "Living things are part of the...", a: ["Biosphere", "Crust", "Mantle", "Core"], c: 0 },
            { q: "Humans need ______ air to breathe.", a: ["Dirty", "Clean", "Smoky", "Hot"], c: 1 },
            { q: "Slate is a type of ________ rock.", a: ["Igneous", "Sedimentary", "Metamorphic", "Soft"], c: 2 },
            { q: "Sandstone is a type of ________ rock.", a: ["Igneous", "Sedimentary", "Metamorphic", "Melted"], c: 1 },
            { q: "The water cycle includes rain and...", a: ["Evaporation", "Burning", "Digging", "Cutting"], c: 0 },
            { q: "Environment includes land, air, and...", a: ["Computers", "Water", "Cars", "Buildings"], c: 1 }
        ]
    };

    let currentUser = localStorage.getItem('arjey_user');
    let currentQuiz = [];
    let qIdx = 0;
    let score = 0;
    let userAnswers = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î
    let currentSet = "";
    let selectedIdx = null;

    // --- LOGIN ---
    window.handleLogin = () => {
        const val = document.getElementById('name-input').value.trim();
        if(!val) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥");
        currentUser = val;
        localStorage.setItem('arjey_user', val);
        showDashboard();
    };

    window.logout = () => { localStorage.removeItem('arjey_user'); location.reload(); };

    function showDashboard() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('main-screen').classList.add('active');
        document.getElementById('user-display').innerText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${currentUser}`;
        loadHistory();
    }

    async function loadHistory() {
        const box = document.getElementById('history-box');
        try {
            const q = query(collection(db, "results"), where("user", "==", currentUser));
            const snap = await getDocs(q);
            let history = [];
            snap.forEach(d => history.push(d.data()));
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡πÉ‡∏ô Client ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡∏Ñ Firebase Indexing
            history.sort((a,b) => b.date.seconds - a.date.seconds);

            if(history.length === 0) { box.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>"; return; }
            
            let html = "<table><tr><th>‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr>";
            history.slice(0, 5).forEach(h => html += `<tr><td>${h.setName}</td><td><b>${h.score}/30</b></td></tr>`);
            box.innerHTML = html + "</table>";
        } catch(e) { box.innerHTML = "‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ"; }
    }

    // --- QUIZ LOGIC ---
    window.startQuiz = (setName) => {
        currentSet = setName;
        currentQuiz = quizData[setName];
        qIdx = 0; score = 0; userAnswers = [];
        document.getElementById('main-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        document.getElementById('quiz-title').innerText = setName;
        renderQuestion();
    };

    function renderQuestion() {
        selectedIdx = null;
        document.getElementById('next-btn').disabled = true;
        const d = currentQuiz[qIdx];
        document.getElementById('q-count').innerText = `${qIdx+1}/30`;
        document.getElementById('progress-fill').style.width = `${((qIdx+1)/30)*100}%`;
        document.getElementById('q-text').innerText = d.q;
        
        const list = document.getElementById('options-list');
        list.innerHTML = "";
        d.a.forEach((ans, i) => {
            const div = document.createElement('div');
            div.className = "option-item";
            div.innerText = ans;
            div.onclick = () => {
                selectedIdx = i;
                document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
                div.classList.add('selected');
                document.getElementById('next-btn').disabled = false;
            };
            list.appendChild(div);
        });
    }

    window.submitAnswer = async () => {
        userAnswers.push(selectedIdx);
        if(selectedIdx === currentQuiz[qIdx].c) score++;
        
        qIdx++;
        if(qIdx < 30) renderQuestion();
        else showSummary();
    };

    async function showSummary() {
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('summary-screen').classList.add('active');
        document.getElementById('final-score').innerText = score;
        
        const wrongBox = document.getElementById('wrong-list');
        wrongBox.innerHTML = "";
        let wrongFound = false;

        currentQuiz.forEach((item, i) => {
            if(userAnswers[i] !== item.c) {
                wrongFound = true;
                const div = document.createElement('div');
                div.className = "review-item";
                div.innerHTML = `
                    <b>‡∏Ç‡πâ‡∏≠ ${i+1}: ${item.q}</b><br>
                    <span class="txt-wrong">‚ùå ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö: ${item.a[userAnswers[i]] || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ö"}</span><br>
                    <span class="txt-correct">‚úÖ ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${item.a[item.c]}</span>
                `;
                wrongBox.appendChild(div);
            }
        });

        if(!wrongFound) wrongBox.innerHTML = "<p style='color:var(--success)'>‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠</p>";

        await addDoc(collection(db, "results"), {
            user: currentUser,
            setName: currentSet,
            score: score,
            date: Timestamp.now()
        });
    }

    if(currentUser) showDashboard();
</script>
</body>
</html>
